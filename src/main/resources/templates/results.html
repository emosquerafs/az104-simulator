<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - AZ-104 Simulator</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Exam Results</h1>
            <a th:href="@{/}" class="btn-back">Back to Home</a>
        </header>

        <main class="main-content">
            <div class="results-summary">
                <div class="score-box" th:classappend="${results.score >= 70} ? 'pass' : 'fail'">
                    <h2>Your Score</h2>
                    <div class="score-value">
                        <span th:text="${#numbers.formatDecimal(results.score, 0, 2)}">0</span>%
                    </div>
                    <div class="score-status">
                        <span th:if="${results.score >= 70}" class="pass">PASS</span>
                        <span th:if="${results.score < 70}" class="fail">FAIL</span>
                        <p class="score-note">Passing score: 70%</p>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Correct</div>
                        <div class="stat-value correct" th:text="${results.correctAnswers}">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Incorrect</div>
                        <div class="stat-value incorrect" th:text="${results.incorrectAnswers}">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total</div>
                        <div class="stat-value" th:text="${results.totalQuestions}">0</div>
                    </div>
                    <div class="stat-card" th:if="${results.durationSeconds != null}">
                        <div class="stat-label">Time Spent</div>
                        <div class="stat-value">
                            [[${results.durationSeconds / 60}]] min
                        </div>
                    </div>
                    <div class="stat-card" th:if="${results.averageTimePerQuestion != null}">
                        <div class="stat-label">Avg. Time/Question</div>
                        <div class="stat-value">
                            [[${#numbers.formatDecimal(results.averageTimePerQuestion, 0, 1)}]] sec
                        </div>
                    </div>
                </div>
            </div>

            <div class="domain-breakdown">
                <h3>Performance by Domain</h3>
                <div class="breakdown-grid">
                    <div th:each="entry : ${results.domainBreakdowns}"
                         th:if="${entry.value.total > 0}"
                         class="breakdown-item">
                        <div class="breakdown-header">
                            <h4 th:text="${entry.key.displayName}">Domain</h4>
                            <span class="breakdown-score"
                                  th:text="${entry.value.correct} + '/' + ${entry.value.total}">0/0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"
                                 th:style="'width: ' + ${entry.value.percentage} + '%'"
                                 th:classappend="${entry.value.percentage >= 70} ? 'pass' : 'fail'">
                            </div>
                        </div>
                        <div class="breakdown-percentage">
                            [[${#numbers.formatDecimal(entry.value.percentage, 0, 1)}]]%
                        </div>
                    </div>
                </div>
            </div>

            <div class="detailed-results">
                <h3>Detailed Question Review</h3>
                <div class="questions-review">
                    <div th:each="qr, iterStat : ${results.questionResults}" class="question-result-item">
                        <div class="question-result-header">
                            <span class="question-number">Question [[${iterStat.index + 1}]]</span>
                            <span class="result-indicator"
                                  th:classappend="${qr.isCorrect} ? 'correct' : 'incorrect'">
                                [[${qr.isCorrect ? '✓ Correct' : '✗ Incorrect'}]]
                            </span>
                        </div>

                        <div class="question-result-body">
                            <div class="question-text" th:utext="${qr.stem}">Question text</div>

                            <div class="options-review">
                                <div th:each="opt : ${qr.options}" class="option-review"
                                     th:classappend="${opt.isCorrect ? 'correct-option' : ''} + ' ' + ${#lists.contains(qr.selectedOptionIds, opt.id) ? 'selected-option' : ''}">
                                    <span class="option-label" th:text="${opt.label}">A</span>
                                    <span class="option-text" th:text="${opt.text}">Option text</span>
                                    <span th:if="${opt.isCorrect}" class="correct-mark">✓ Correct Answer</span>
                                    <span th:if="${!opt.isCorrect && #lists.contains(qr.selectedOptionIds, opt.id)}"
                                          class="incorrect-mark">✗ Your Answer</span>
                                </div>
                            </div>

                            <div class="explanation-review">
                                <h5>Explanation:</h5>
                                <p th:text="${qr.explanation}">Explanation text</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="results-actions">
                <a th:href="@{/}" class="btn btn-primary btn-large">
                    Return to Home
                </a>
            </div>
        </main>
    </div>
</body>
</html>
